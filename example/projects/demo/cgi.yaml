endpoints:
  - method: GET # no path is default path
    exec: ping -c 3 1.1.1.1

  - method: GET
    path: "ping/{host}" # params are supported
    exec: "ping -c 3 $DHOST"
    environment:
      DHOST: '{{.Path.host}}'

  - method: POST
    path: echo
    exec: cat -
    policies:
      - local_admin

  - method: GET
    path: date
    aliases:
      - what-time-is-it
    exec: ./time.sh
    environment:
      FORMAT: '{{.Query.Get "format"}}'

queues:
  - method: POST
    path: ping
    exec: "ping -c 3 1.1.1.1"
    policies:
      - local_admin

  - method: POST
    path: "calc"
    vars:
      request_id: "{{uuidv4}}"
    exec: "mkdir -p out && bc - > out/$REQUEST_ID"
    environment:
      REQUEST_ID: "{{.Var.request_id}}"
    headers:
      "X-Correlation-Id": "{{.Var.request_id}}"

policy:
  - name: local_admin
    ips:
      - 127.0.0.1
    origins:
      - 127.0.0.1:3434
      - localhost:3434
      - localhost
      - 127.0.0.1
    tokens:
      - title: "Default token"
        hash: "$apr1$lkIddIBx$h9m9mPGzJv0.fD8chW78b1" # admin
      - hash: "$apr1$TyJMAZz/$5LAF57zcAtVbpQru9BPBU0" # qwerty


crons:
  - schedule: "@hourly"
    exec: 'wall "hello world"'